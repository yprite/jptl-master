# 프로젝트 개발 규칙 (.cursorrules)

이 파일은 Cursor AI 어시스턴트가 프로젝트 개발 시 반드시 준수해야 하는 규칙들을 정의합니다.
DEVELOPMENT_GUIDELINES.md 파일의 핵심 내용을 기반으로 하며, 모든 코드 작성 및 리뷰 시 이 규칙을 우선적으로 적용합니다.

## 관련 문서 참조

더 자세한 내용은 다음 문서들을 참고하세요:
- **[DEVELOPMENT_GUIDELINES.md](../DEVELOPMENT_GUIDELINES.md)**: 전체 개발 가이드라인 및 프로세스
- **[docs/README.md](docs/README.md)**: 문서 구조 및 개요
- **[docs/requirements.md](docs/requirements.md)**: 프로젝트 요구사항
- **[docs/development/setup.md](docs/development/setup.md)**: 개발 환경 설정
- **[docs/architecture/overview.md](docs/architecture/overview.md)**: 아키텍처 개요
- **[docs/task-management/README.md](docs/task-management/README.md)**: 태스크 관리 가이드

## 핵심 개발 원칙

### 1. 오버엔지니어링 방지
- KISS 원칙 준수: 불필요하게 복잡한 설계를 피합니다
- YAGNI 원칙 준수: 실제로 필요한 기능만 구현합니다
- 현재 요구사항에만 집중합니다

### 2. TDD (Test-Driven Development) 필수
- Red-Green-Refactor 사이클 준수
- 기능 구현 전에 반드시 테스트를 먼저 작성합니다
- 모든 테스트가 통과하지 않으면 다음 단계로 진행하지 않습니다
- 📖 자세한 내용: [DEVELOPMENT_GUIDELINES.md](../DEVELOPMENT_GUIDELINES.md#04-개발-프로세스-문서--테스트--개발--커밋--pr--태스크-업데이트)

### 3. 커밋 관리
- 하나의 커밋은 최대 100라인으로 유지
- 하나의 커밋은 하나의 논리적 변경사항만 포함
- 빈번한 커밋을 권장합니다
- **모든 작업 즉시 커밋**: 코드 변경, 문서 업데이트, 설정 변경 등 모든 작업을 즉시 커밋합니다
- **작업 단위별 커밋**: 논의, 계획, 구현, 테스트 등 각 단계별로 커밋합니다
- **모든 커밋 즉시 푸시**: 모든 커밋 후 즉시 원격 저장소에 푸시합니다
- 📖 자세한 내용: [DEVELOPMENT_GUIDELINES.md](../DEVELOPMENT_GUIDELINES.md#03-git-관리-커밋--푸시)

### 3-1. Git 브랜치 및 푸시 자동화 (필수)
- **브랜치 자동 생성**: 모든 작업 시작 전에 반드시 새로운 브랜치를 생성합니다
  - **모든 브랜치는 develop 브랜치에서 분기**: 작업 시작 전 develop 브랜치로 체크아웃하고 최신 상태로 업데이트한 후 새 브랜치 생성
  - 기능 개발: `feature/작업-설명` 형식 (예: `feature/user-authentication`)
  - 버그 수정: `bugfix/작업-설명` 형식 (예: `bugfix/login-error`)
  - 문서 작업: `docs/작업-설명` 형식 (예: `docs/api-documentation`)
  - 리팩토링: `refactor/작업-설명` 형식 (예: `refactor/user-service`)
  - 테스트: `test/작업-설명` 형식 (예: `test/coverage-improvement`)
- **브랜치 생성 후 즉시 체크아웃**: 새 브랜치를 생성하면 반드시 해당 브랜치로 전환합니다
- **커밋 자동화**: 코드 변경사항이 있을 때마다 자동으로 커밋합니다
  - 커밋 메시지는 규칙 11의 형식을 따릅니다
  - 테스트 통과 후에만 커밋합니다
- **푸시 자동화**: 모든 커밋 후 즉시 원격 저장소에 푸시합니다
  - `git push origin <브랜치명>` 형식으로 푸시합니다
  - 첫 푸시 시 `-u` 옵션을 사용하여 upstream을 설정합니다
- **PR 자동 생성**: 작업 완료 후 자동으로 Pull Request를 생성합니다
  - GitHub CLI (`gh`)를 사용하여 PR 생성 (`gh pr create --title "type(scope): subject" --body "작업 설명"`)
  - PR은 기본적으로 `develop` 브랜치로 향하도록 설정합니다
  - PR 제목은 커밋 메시지 형식을 따릅니다
  - PR 본문에는 작업 내용, 변경사항, 테스트 결과를 포함합니다
- **작업 완료 전 브랜치 유지**: 작업이 완전히 끝날 때까지 브랜치를 유지합니다

## 코드 품질 및 스타일

### 4. 코드 스타일
- Python: PEP 8 준수
- 함수/변수: snake_case
- 클래스: PascalCase
- 상수: UPPER_SNAKE_CASE
- 줄 길이: 88자 이내
- 들여쓰기: 스페이스 4개

### 5. 코드 구조
- 각 모듈은 단일 책임을 가짐
- 함수는 20줄 이내로 유지
- 불필요한 주석은 피함

## 서버 아키텍처 (DDD 기반)

### 6. DDD 레이어 구조
- **Domain Layer**: Entity, Value Object, Domain Service, Aggregate
- **Application Layer**: Application Service, Command/Query 객체
- **Infrastructure Layer**: Repository 구현, 외부 서비스 어댑터
- **Presentation Layer**: Controller, DTO, API 문서화
- 📖 자세한 내용: [docs/architecture/overview.md](docs/architecture/overview.md), [docs/architecture/repositories.md](docs/architecture/repositories.md)

### 7. DDD 구현 원칙
- 의존성 역전 원칙 준수
- 단일 책임 원칙 적용
- 개방 폐쇄 원칙 준수
- 인터페이스 분리 원칙 적용

## 테스트 전략

### 8. 테스트 커버리지 필수 요구사항 (강제)
- 백엔드: 최소 80% 코드 커버리지 필수 (미달 시 테스트 실패)
- 프론트엔드: 최소 70% 코드 커버리지 필수 + 주요 사용자 플로우 100% 커버리지 (미달 시 테스트 실패)
- 새로운 기능 추가 시 반드시 해당 영역의 테스트 코드를 작성합니다
- 커버리지 미달 시 모든 작업 중단 및 테스트 작성 우선 진행
- 📖 자세한 내용: [DEVELOPMENT_GUIDELINES.md](../DEVELOPMENT_GUIDELINES.md#31-백엔드-테스트-종류)

### 8-1. 시나리오 테스트 필수 요구사항 (강제)
- **시나리오 테스트 필수 작성**: 모든 주요 사용자 플로우에 대한 시나리오 테스트를 반드시 작성합니다
- **시나리오 테스트 파일 위치**: `tests/test_scenarios.py` 파일에 모든 시나리오 테스트를 작성합니다
- **시나리오 테스트 범위**: 
  - 여러 API 엔드포인트 간 상호작용 검증
  - 실제 사용자 플로우 전체 검증 (예: 사용자 생성 → 시험 시작 → 문제 조회 → 답안 제출 → 결과 조회)
  - 데이터 흐름 및 상태 전이 검증
- **새로운 기능 추가 시**: 해당 기능을 포함하는 시나리오 테스트를 반드시 추가합니다
- **시나리오 테스트 작성 원칙**:
  - 하나의 시나리오 테스트는 하나의 완전한 사용자 플로우를 검증합니다
  - 테스트 이름은 "test_scenario_<사용자_행동>_<예상_결과>" 형식을 따릅니다 (예: `test_scenario_user_takes_test_and_views_result`)
  - 실제 사용자가 수행하는 순서대로 API를 호출합니다
  - 각 단계의 응답을 검증하고, 다음 단계에 필요한 데이터를 추출하여 사용합니다
- **시나리오 테스트 실행**: 모든 단위 테스트와 함께 시나리오 테스트도 실행되며, 실패 시 작업 진행 금지
- 📖 자세한 내용: [DEVELOPMENT_GUIDELINES.md](../DEVELOPMENT_GUIDELINES.md#31-백엔드-테스트-종류)

### 9. 테스트 안티패턴 금지
- 데이터베이스 직접 테스트 금지 (목 사용)
- 외부 API 호출 금지 (목 사용)
- 시간 의존적 테스트 금지
- 비결정적 테스트 금지
- 테스트 간 상태 공유 금지
- DOM 직접 조작 금지 (프론트엔드)
- 구현 세부사항 테스트 금지

## 버전 관리 (Git)

### 10. 브랜치 전략
- main: 프로덕션 배포용
- develop: 통합 브랜치
- feature/*: 새로운 기능
- bugfix/*: 버그 수정
- hotfix/*: 긴급 수정
- **모든 작업은 새 브랜치에서 진행**: develop이나 main 브랜치에서 직접 작업하지 않습니다
- **모든 브랜치는 develop에서 분기**: 모든 작업 브랜치(feature, bugfix, docs, refactor, test)는 반드시 develop 브랜치에서 분기합니다
- **브랜치 필수 생성**: 모든 작업은 새로운 브랜치를 생성하여 진행합니다
- **작업 단위별 브랜치**: 하나의 논리적 작업 단위마다 별도 브랜치를 생성합니다
- 📖 자세한 내용: [DEVELOPMENT_GUIDELINES.md](../DEVELOPMENT_GUIDELINES.md#21-브랜치-전략), [docs/development/setup.md](docs/development/setup.md#git-저장소-설정)

### 11. 커밋 메시지 형식
```
type(scope): subject

body

footer
```
- type: feat, fix, docs, style, refactor, test, chore
- scope: 변경 영역 (api, ui, db 등)
- subject: 50자 이내 요약

## 보안 및 성능

### 12. 보안 원칙
- 민감한 정보는 환경 변수로 관리
- 입력값 철저한 검증
- SQL 인젝션, XSS 등 취약점 방지

### 13. 성능 기준
- API 응답: 500ms 이내
- DB 쿼리: N+1 문제 방지
- 메모리 사용량: 합리적 범위 유지

## AI 어시스턴트 행동 지침

### 14. 코드 작성 시 준수사항
- 모든 코드는 위 규칙을 우선적으로 따름
- TDD 방식으로 개발 진행
- 오버엔지니어링을 피하고 간단한 해결책 선택
- 테스트를 먼저 작성하고 구현
- 커밋은 작고 의미있게 유지
- **작업 시작 전 반드시 새 브랜치 생성 및 체크아웃**
- **모든 변경사항 즉시 커밋 및 푸시**

### 14-1. Git 작업 자동화 프로세스 (필수)
1. **작업 시작 시**:
   - 현재 브랜치 확인 (`git branch` 또는 `git status`)
   - **develop 브랜치로 체크아웃**: `git checkout develop`
   - **develop 브랜치 최신화**: `git pull origin develop` (또는 `git fetch origin && git merge origin/develop`)
   - 작업 유형에 맞는 새 브랜치 생성 (`git checkout -b feature/작업명` 등)
   - 새 브랜치로 체크아웃 확인

2. **코드 변경 후**:
   - 변경사항 확인 (`git status`)
   - 테스트 실행 및 통과 확인
   - 변경사항 스테이징 (`git add .` 또는 특정 파일)
   - 규칙 11에 따른 커밋 메시지로 커밋 (`git commit -m "type(scope): subject"`)
   - 즉시 원격 저장소에 푸시 (`git push -u origin <브랜치명>` 또는 `git push`)

3. **작업 완료 시**:
   - 최종 테스트 실행 및 통과 확인
   - 모든 변경사항 커밋 및 푸시 확인
   - 브랜치 상태 확인
   - Pull Request 자동 생성
     - GitHub CLI 사용: `gh pr create --title "type(scope): subject" --body "작업 설명 및 변경사항" --base develop`
     - PR 제목은 마지막 커밋 메시지 형식을 따릅니다
     - PR 본문에는 작업 내용, 주요 변경사항, 테스트 결과를 포함합니다
     - PR 생성 후 PR URL을 사용자에게 알립니다

### 15. 리뷰 및 피드백 시 준수사항
- DEVELOPMENT_GUIDELINES.md 위반 사항 즉시 지적
- 테스트 커버리지 필수 확인: 백엔드 80%, 프론트엔드 70% 미달 시 즉시 중단
- 커버리지 미달 시 테스트 작성 후 재실행 필수
- 보안 및 성능 이슈 검토
- 코드 가독성 및 유지보수성 평가

### 16. 문제 해결 시 접근방식
- 가장 간단하고 직접적인 해결책 우선 고려
- 불필요한 추상화나 복잡성 피함
- 실제 요구사항에 기반한 구현
- 테스트로 검증된 변경사항만 승인

### 17. 문서화 요구사항
- 코드 변경 즉시 docs/ 폴더의 관련 문서 업데이트
- 새로운 기능 추가 시 해당 기능 문서 생성
- API 변경 시 docs/api/ 폴더 문서 업데이트
- 아키텍처 변경 시 docs/architecture/ 문서 업데이트
- 문서 리팩토링 필요시 즉시 수행
- CHANGELOG.md에 모든 변경사항 기록
- 📖 자세한 내용: [docs/README.md](docs/README.md), [docs/CHANGELOG.md](docs/CHANGELOG.md)

### 18. 프론트엔드 특화 규칙
- Atomic Design 패턴으로 컴포넌트 구조화
- 단방향 데이터 흐름과 컴포넌트 합성 우선 사용
- WCAG 2.1 AA 준수로 접근성 보장
- React.memo, useMemo, useCallback으로 성능 최적화
- 모바일 우선 반응형 디자인 적용
- 브라우저 호환성과 점진적 향상 고려

### 19. 태스크 및 스프린트 관리
- 1주 단위 스프린트 운영으로 작업 관리
- 우선순위 기반(P0-P3) 태스크 처리
- 모든 태스크는 수용 기준과 템플릿 준수
- 스프린트 문서와 백로그 실시간 업데이트
- 📖 자세한 내용: [docs/task-management/README.md](docs/task-management/README.md), [docs/task-management/backlog.md](docs/task-management/backlog.md), [docs/task-management/current-sprint.md](docs/task-management/current-sprint.md)

### 20. 테스트 실행 및 커버리지 검증 (필수)
- 모든 테스트 실행 시 커버리지 체크 필수 포함
- 백엔드 커버리지 80% 미달 시 테스트 실패로 처리
- 프론트엔드 커버리지 70% 미달 시 테스트 실패로 처리
- 커버리지 미달 시 다음 작업 진행 금지
- run_tests.sh 스크립트에 커버리지 임계값 검증 포함

이 규칙들은 프로젝트의 일관성과 품질을 유지하기 위한 필수 지침입니다.
모든 코드 변경사항은 이 규칙들을 위반하지 않아야 합니다.
